@using Community.Blazor.MapLibre.Models
@namespace Ellipse.Components.Shared.Menu

<MudDrawer @bind-Open="_open" Anchor="Anchor.Left" Elevation="8" Variant="DrawerVariant.Persistent" Overlay="false"
           Class="@_class"
           Style="transition: transform 0.4s ease, width 0.4s ease;" Width="350px">
    <!-- Drawer Header -->
    <MudDrawerHeader
        Class="flex items-center justify-between p-4 bg-gradient-to-r from-blue-600 to-blue-800 text-white rounded-t-lg shadow">
        <MudText Typo="Typo.h5" Class="font-bold tracking-wide">
            Location Details
        </MudText>
        <MudIconButton Icon="@Icons.Material.Filled.Close" @onclick="ToggleOpen" Edge="Edge.End"
                       Class="text-white hover:text-gray-300 transition-colors duration-200"/>
        @if (!IsList)
        {
            <MudIconButton Icon="@Icons.Material.Filled.ArrowBack" OnClick="() => ToggleView()" Edge="Edge.Start"
                           Class="text-white hover:text-gray-300 transition-colors duration-200"/>
        }
    </MudDrawerHeader>

    <!-- Drawer Content -->
    @if (IsList)
    {
        if (_markers.Count > 0)
        {
            <Virtualize TItem="KeyValuePair<LngLat, Dictionary<string, dynamic>>" Context="kvp"
                        Items="@_markers.ToList()">
                <ItemContent>
                    @ListItem((kvp.Value["Name"], kvp.Key, kvp.Value["Routes"]["Average"].Distance, kvp.Value["Routes"]["Average"].Duration))
                </ItemContent>
                <Placeholder>
                    <MudSkeleton SkeletonType="SkeletonType.Rectangle" Width="100%" Height="100%"/>
                </Placeholder>
                <EmptyContent>
                    <MudText>There are no markers</MudText>
                </EmptyContent>
            </Virtualize>
        }
        else
        {
            <MudSkeleton Animation="Animation.Wave" SkeletonType="SkeletonType.Rectangle" Height="200px"/>
        }
    }
    else if (_selectedMarkerData != null)
    {
        @SingleItem((_selectedMarkerData, _selectedMarkerData["Routes"]))
    }
</MudDrawer>
