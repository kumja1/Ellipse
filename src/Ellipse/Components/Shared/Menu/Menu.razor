@using Community.Blazor.MapLibre.Models

<div class="@_class">
    <MudDrawer @bind-Open="Open"
               Anchor="Anchor.Left"
               Elevation="0"
               Variant="DrawerVariant.Persistent"
               Overlay="false"
               Style="transition: transform 0.4s ease, width 0.4s ease;"
               Width="400px"
               Height="100%"
               Class="border-r overflow-y-auto">

        <MudDrawerHeader
            Class="flex items-center justify-between px-4 py-3 border-b">
            <MudText Typo="Typo.h6" Class="font-bold text-gray-800">
                Locations
            </MudText>

            <MudIconButton Icon="@Icons.Material.Filled.Close"
                           @onclick="ToggleOpen"
                           Size="Size.Small"
                           Class="text-gray-400 hover:text-gray-600 transition-colors"/>
        </MudDrawerHeader>

        @if (IsList)
        {
            <Virtualize TItem="KeyValuePair<LngLat, Dictionary<string, dynamic>>"
                        Context="kvp"
                        Items="@_markers.ToList()">
                <ItemContent>
                    @ListItem((kvp.Value["Name"], kvp.Key,
                        kvp.Value["Routes"]["Average"].Distance,
                        kvp.Value["Routes"]["Average"].Duration))
                </ItemContent>
                <Placeholder>
                    <MudSkeleton Animation="Animation.Wave"
                                 SkeletonType="SkeletonType.Rectangle"
                                 Height="200px"/>
                </Placeholder>
            </Virtualize>
        }
    </MudDrawer>
    @if (!IsList && _selectedMarkerData != null && Open)
    {
        <div class="fixed left-[400px] top-4 z-30 ml-4 transition-all duration-300 pointer-events-none">
            <MudPaper Elevation="6"
                      Class="p-0 w-[360px] rounded-lg overflow-hidden pointer-events-auto">
                @SingleItem((_selectedMarkerData, _selectedMarkerData["Routes"]))
            </MudPaper>
        </div>
    }

</div>
